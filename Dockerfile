FROM node


#ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD true
ENV DEBIAN_FRONTEND=noninteractive 

# Install chromium for md-to-pdf package
RUN apt update && \
    apt install -y chromium

# Install pnpm package manager
RUN corepack enable && \
    corepack prepare pnpm@7.11.0 --activate

# Load application
WORKDIR /server
COPY . .
RUN chown -R www-data .

# Install dependencies
RUN make install

# Create flag.txt in application folder
RUN make flag

USER www-data

ENTRYPOINT ["make"]
CMD ["run"]