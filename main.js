import exp from 'constants'
import express from 'express'
import { mdToPdf } from 'md-to-pdf'

const indexPage = 'index.html'
const publicFolder = 'public'
const port = 80
const dir = process.cwd()

const app = express()

app.use(express.urlencoded({ extended: true }))
app.use(express.static(publicFolder))

// Post markdown to convert
app.post('/convert', async (req, res) => {
    if (!req.body.markdown) {
        res.status(400).send('No markdown provided')
        return
    }

    console.log(`Converting ${req.body.markdown.length} long md to pdf for ${req.ip}`)
    const pdf = await mdToPdf({
        content: req.body.markdown,
    })
    console.log(pdf)

    res.contentType('application/pdf')
    res.send(pdf.content)
})

app.listen(80, () => console.log(`Listening on port ${port}`))
